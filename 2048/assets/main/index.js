window.__require=function t(e,o,r){function n(c,s){if(!o[c]){if(!e[c]){var a=c.split("/");if(a=a[a.length-1],!e[a]){var l="function"==typeof __require&&__require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var f=o[c]={exports:{}};e[c][0].call(f.exports,function(t){return n(e[c][1][t]||t)},f,f.exports,t,e,o,r)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<r.length;c++)n(r[c]);return n}({Cell:[function(t,e,o){"use strict";cc._RF.push(e,"e4590INnvdJgKuhfMDm/zxt","Cell");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),n=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,c=i.ccclass,s=i.property,a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.start=function(){this.node.width=80,this.node.height=80},n([s(cc.Label)],e.prototype,"label",void 0),e=n([c],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],Grid:[function(t,e,o){"use strict";cc._RF.push(e,"480f1GWkD1PlpiKaedrqtaV","Grid");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),n=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i,c=cc._decorator,s=c.ccclass,a=c.property;(function(t){t[t.none=0]="none",t[t.up=1]="up",t[t.left=2]="left",t[t.right=3]="right",t[t.down=4]="down"})(i||(i={}));var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.score=null,e.bestScore=null,e.gameover=null,e.grid=[],e.row=4,e.col=4,e.dir=i.none,e.canNextStep=!0,e}return r(e,t),e.prototype.onLoad=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},e.prototype.onDestroy=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},e.prototype.start=function(){var t=this;this.init(),this.initHandler(),this.gameover.node.getChildByName("replay").on(cc.Node.EventType.TOUCH_START,function(){t.replayGame()})},e.prototype.init=function(){var t=this;this.score.string="0",this.gameover.node.opacity=0;var e=this.grid;this.walkCells(function(o){for(var r=new Array(t.col),n=0;n<t.col;++n){var i=cc.instantiate(t.cellPrefab);t.node.addChild(i),i.color=cc.color(238,228,218,.35),i.getComponent("Cell").label.string="",t.setCellPosition(i,o,n)}e[o]=r}),this.setBestScore(),this.createRandomCell(),this.createRandomCell()},e.prototype.onKeyDown=function(t){if(this.canNextStep)switch(this.canNextStep=!1,t.keyCode){case cc.macro.KEY.w:this.moveUp();break;case cc.macro.KEY.d:this.moveRight();break;case cc.macro.KEY.a:this.moveLeft();break;case cc.macro.KEY.s:this.moveDown()}else console.log("disable")},e.prototype.walkCells=function(t){for(var e=this.row,o=this.col,r=0;r<e;++r)for(var n=0;n<o;++n)t(r,n)},e.prototype.createCell=function(t,e){var o=cc.instantiate(this.cellPrefab);this.node.addChild(o),this.grid[t][e]=o,this.setCellPosition(o,t,e),o.setScale(0);var r=cc.scaleTo(.5,1).easing(cc.easeCubicActionOut());o.runAction(r)},e.prototype.createRandomCell=function(){var t=[],e=this.grid;if(this.walkCells(function(o,r){e[o][r]||t.push({i:o,j:r})}),t.length){var o=Math.floor(Math.random()*t.length),r=t[o],n=r.i,i=r.j;return this.createCell(n,i),!0}return!1},e.prototype.setCellPosition=function(t,e,o,r,n){void 0===r&&(r=!1),void 0===n&&(n=function(){});var i=cc.v2(50+100*o,-50-100*e);if(r){var c=cc.moveTo(.5,i).easing(cc.easeCubicActionOut());t.runAction(cc.sequence(c,cc.callFunc(n)))}else t.setPosition(i);n()},e.prototype.addScore=function(t){var e=this.score,o=parseInt(e.string);e.string=o+t},e.prototype.getBestScore=function(){return cc.sys.localStorage.getItem("LOCAL_BEST_SCORE_KEY")||"0"},e.prototype.setBestScore=function(){this.bestScore.string=this.getBestScore()},e.prototype.gameDie=function(){this.gameover.node.opacity=1;var t=this.getBestScore(),e=this.score.string;e>t&&cc.sys.localStorage.setItem("LOCAL_BEST_SCORE_KEY",e)},e.prototype.replayGame=function(){this.init()},e.prototype.afterEachRound=function(){this.createRandomCell()?this.canNextStep=!0:this.gameDie()},e.prototype.initHandler=function(){var t=this,e=this.row,o=this.col,r=this.grid,n=function(e,o){for(var r,n=o.col,i=o.row,c=[],s=function(e,o){var r=function(){e.removeFromParent()};void 0===n?t.setCellPosition(e,i,o,!0,r):t.setCellPosition(e,o,n,!0,r)},a=function(o,r,n){if(o&&r){var i=o.getComponent("Cell").label,a=r.getComponent("Cell").label;if(i.string===a.string){var l=2*parseInt(i.string);t.addScore(l),i.string=l,c.unshift(n),e[n]=void 0,s(r,n)}}},l=0;l<e.length;++l)if(e[l])if(void 0!==r){e[r]=e[l],e[l]=void 0,c.push(l),a(e[r-1],e[r],r),r=c.shift()}else{a(e[l-1],e[l],l),r=c.shift()}else c.push(l),void 0===r&&(r=c.shift());return e},i=function(){var e=0,o=0;t.walkCells(function(o,r){t.grid[o][r]&&e++}),t.walkCells(function(r,n){var i=t.grid[r][n];i&&t.setCellPosition(i,r,n,!0,function(){++o===e&&setTimeout(function(){t.afterEachRound()})})})};this.moveUp=function(){for(var t=0;t<o;++t){for(var c=[],s=0;s<e;++s)c.push(r[s][t]);n(c,{col:t});for(s=0;s<e;++s)r[s][t]=c.shift()}i()},this.moveDown=function(){for(var t=0;t<o;++t){for(var c=[],s=e-1;s>=0;--s)c.push(r[s][t]);n(c,{col:t});for(s=e-1;s>=0;--s)r[s][t]=c.shift()}i()},this.moveRight=function(){for(var t=e-1;t>=0;--t){for(var c=[],s=o-1;s>=0;--s)c.push(r[t][s]);n(c,{row:t});for(s=o-1;s>=0;--s)r[t][s]=c.shift()}i()},this.moveLeft=function(){for(var t=0;t<e;++t){var o=r[t].slice();n(o,{row:t}),r[t]=o}i()}},n([a(cc.Prefab)],e.prototype,"cellPrefab",void 0),n([a(cc.Label)],e.prototype,"score",void 0),n([a(cc.Label)],e.prototype,"bestScore",void 0),n([a(cc.Sprite)],e.prototype,"gameover",void 0),e=n([s],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],use_reversed_rotateTo:[function(t,e,o){"use strict";cc._RF.push(e,"090bdYo0L9N/boBYaekbsPa","use_reversed_rotateTo"),cc.RotateTo._reverse=!0,cc._RF.pop()},{}]},{},["Cell","Grid","use_reversed_rotateTo"]);